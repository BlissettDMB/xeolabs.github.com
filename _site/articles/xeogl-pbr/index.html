<section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#api-additions" id="markdown-toc-api-additions">API additions</a></li>
  <li><a href="#combining-textures" id="markdown-toc-combining-textures">Combining textures</a></li>
  <li><a href="#work-remaining" id="markdown-toc-work-remaining">Work remaining</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->
<p>This month I made more progress extending <a href="http://xeogl.org">xeogl</a> to support Physically Based Rendering (PBR), which is an approach to rendering 
that uses real world values to provide results that are more accurate and consistent under all lighting conditions. 
<br /><br />
xeogl’s PBR is fairly standard so far:</p>

<ul>
  <li>Cook-Torrance BRDF</li>
  <li>GGX microfacet distribution</li>
  <li>Shlick’s approximation for specular Fresnel</li>
  <li>Image-base lighting</li>
</ul>

<p>I also extended xeogl to load <a href="https://github.com/KhronosGroup/glTF">glTF</a> models with PBR materials, for 
both <em>metallic/roughness</em> and <em>specular/glossiness</em> work flows, using the FRAUNHOFER_materials_pbr extension.
<br /><br />
Check out some demos:
—-|—-|—-
<a href="http://xeogl.org/examples/#importing_gltf_pbr_metallic_helmet"><img src="http://xeolabs.com/images/xeogl/MetallicMaterial/helmet.png" alt="" /></a> | <a href="http://xeogl.org/examples/#materials_metallic_fireHydrant"><img src="http://xeolabs.com/images/xeogl/MetallicMaterial/hydrant0.png" alt="" /></a> | <a href="http://xeogl.org/examples/#importing_gltf_pbr_specular_saw"><img src="http://xeolabs.com/images/xeogl/SpecularMaterial/reciprocatingSaw.png" alt="" /></a> | <a href="http://xeogl.org/examples/importing_scenejs_tronTank.html"><img src="http://xeolabs.com/images/xeogl/MetallicMaterial/scenejsTronTank.png" alt="" /></a> | <a href="http://xeogl.org/examples/#importing_gltf_pbr_metallic_telephone"><img src="http://xeolabs.com/images/xeogl/MetallicMaterial/telephone.png" alt="" /></a></p>

<p>This is still a work in progress, as I’m following along behind the current development of the glTF 2.0 spec. Also, I’m learning PBR 
 as I go here, and still need to implement some of those little things in the shaders that really make it look good, like HDR lighting, 
gamma correction and tone mapping.
<br /><br />
For an introduction to PBR concepts, check out the <a href="https://www.allegorithmic.com/pbr-guide">Allegorithmic PBR Guide</a>.
<br /></p>

<h3 id="api-additions">API additions</h3>

<p>To support PBR, I added two new material component types to xeogl, which closely follow glTF’s PBR spec:</p>

<ul>
  <li><a href="http://xeogl.org/docs/classes/MetallicMaterial.html">MetallicMaterial</a> to support a <em>metallic/roughness</em> workflow, and</li>
  <li><a href="http://xeogl.org/docs/classes/SpecularMaterial.html">SpecularMaterial</a> to support a <em>specular/glossiness</em> workflow.</li>
</ul>

<p>The code snippet below, which creates the yellow fire hydrant example shown above, gives an example of how these 
materials are used within xeogl’s entity-component API.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Entity with ObjGeometry and MetallicMaterial components</span>
 
<span class="kd">var</span> <span class="nx">fireHydrant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">Entity</span><span class="p">({</span>

   <span class="nx">geometry</span><span class="o">:</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">OBJGeometry</span><span class="p">({</span>
       <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;models/obj/FireHydrantMesh.obj&quot;</span>
   <span class="p">}),</span>

   <span class="nx">material</span><span class="o">:</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">MetallicMaterial</span><span class="p">({</span>        
       <span class="nx">baseColorMap</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">Texture</span><span class="p">({</span>  <span class="c1">// RGB is baseColor</span>
           <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;textures/diffuse/fire_hydrant_Base_Color.png&quot;</span>
       <span class="p">}),</span>
       <span class="nx">metallicMap</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">Texture</span><span class="p">({</span>   <span class="c1">// R component is metallic</span>
           <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;textures/metallic/fire_hydrant_Metallic.png&quot;</span>
       <span class="p">}),</span>
       <span class="nx">roughnessMap</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">Texture</span><span class="p">({</span>  <span class="c1">// R component is roughness</span>
           <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;textures/roughness/fire_hydrant_Roughness.png&quot;</span>
       <span class="p">}),</span>
       <span class="nx">occlusionMap</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">Texture</span><span class="p">({</span>  <span class="c1">// R component is ambient occlusion</span>
           <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;textures/occlusion/fire_hydrant_Mixed_AO.png&quot;</span>
       <span class="p">}),</span>
       <span class="nx">normalMap</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">xeogl</span><span class="p">.</span><span class="nx">Texture</span><span class="p">({</span>
           <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;textures/normal/fire_hydrant_Normal_OpenGL.png&quot;</span>
       <span class="p">})</span>
   <span class="p">})</span>
<span class="p">});</span></code></pre></div>

<h3 id="combining-textures">Combining textures</h3>

<p>Note that each channel on the MetallicMaterial in our hydrant example has its own individual texture. This happens to allow us to 
switch each texture on and off with a GUI, so that we can see its effect.
<br /><br />
To reduce download times, however, glTF combines some material channels within the same textures. Therefore, for compatibility with glTF, 
I also made xeogl support these multichannel textures. For instance, instead of having a <strong>metallicMap</strong> and a <strong>roughnessMap</strong> the 
MetallicMaterial from our example could instead have a combined <strong>metallicRoughnessMap</strong>, which would have <em>metalness</em> in its 
texture’s R component and <em>roughness</em> in its G component.</p>

<h3 id="work-remaining">Work remaining</h3>

<ul>
  <li>Proper accreditation on all models.</li>
  <li>Organize glTF examples better. Organize them into 1.0, 1.1 and 2.0 categories so that xeogl support can be checked at a glance.</li>
  <li>HDR for IBL (looks so rough without this).</li>
  <li>Gamma correction - not sure yet at what scope to do this in the API - per material, per model or entire scene?</li>
  <li>Tone mapping - will probably need to build up a postprocessing framework and make this an effect that plugs into it.</li>
</ul>

