<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Using the SceneJS Depth Buffer &#8211; xeoLabs</title>
<meta name="description" content="Using the depthbuf node to configure the depth buffer for subgraphs">
<meta name="keywords" content="scenejs, tutorial, depthbuf">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Using the SceneJS Depth Buffer">
<meta name="twitter:description" content="Using the depthbuf node to configure the depth buffer for subgraphs">
<meta name="twitter:creator" content="@xeolabs">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Using the SceneJS Depth Buffer">
<meta property="og:description" content="Using the depthbuf node to configure the depth buffer for subgraphs">
<meta property="og:url" content="/articles/scenejs-depthbuf">
<meta property="og:site_name" content="xeoLabs">





<link rel="canonical" href="/articles/scenejs-depthbuf">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="xeoLabs Feed">
<link rel="author" href="https://plus.google.com/u/0/110983138227486752827/posts?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="article" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="">xeoLabs</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="/about" >About</a></li>
		        
				<li><a href="/articles" >Articles</a></li>
		        
				<li><a href="http://scenejs.org" target="_blank">SceneJS.org</a></li>
		        
				<li><a href="http://biodigitalhuman.com" target="_blank">BioDigitalHuman.com</a></li>
		        
		        <li><i class="icon-feed"></i> <a href="/feed.xml" title="Atom/RSS feed">Feed</a>
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <div class="article-author-top">
    <img src="/images/largePortrait.jpg" class="bio-photo" alt="@xeoLabs bio photo"></a>
<h3><a href="http://xeolabs.com">@xeoLabs</a></h3>
<p>Lindsay Kay<br>3D Web developer</p>
<a href="http://twitter.com/xeolabs" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>

<a href="https://plus.google.com/u/0/110983138227486752827/posts" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>

<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>


  </div>
  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      <h1 itemprop="name">Using the SceneJS Depth Buffer</h1>
      <h2></h2>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap" itemprop="text">
      <section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#depth-what">Depth what?</a></li>
  <li><a href="#example">Example</a>    <ul>
      <li><a href="#setting-cleardepth">Setting clearDepth</a></li>
      <li><a href="#setting-depthfunc">Setting depthFunc</a></li>
    </ul>
  </li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<p>In this tutorial we’ll check out the SceneJS <code>depthbuf</code> node, which configures the depth buffer for the
 nodes in its subgraph.</p>

<h2 id="depth-what">Depth what?</h2>

<p>When an object is rendered, the Z-depth of each pixel is stored in the <em>depth buffer</em>, which is a two-dimensional
array (x-y) with one element for each pixel. If another object is to be rendered at the same pixel, the buffer
compares the two depths and overrides the current pixel if the new object is closer to the viewpoint. The chosen
depth is then saved to the buffer, replacing the old one. In short, the buffer ensures corrrect depth perception,
where a close object hides a farther one.</p>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Z-buffering">Wikipedia article</a></li>
  <li><a href="http://learningwebgl.com/blog/?p=859">Learning WebGL</a></li>
</ul>

<h2 id="example">Example</h2>

<p>Let’s create a teapot wrapped in a <code>depthbuf</code> that has default attribute values:</p>

<div class="highlight"><pre><code class="javascript"> <span class="c1">// Create scene</span>
 <span class="kd">var</span> <span class="nx">scene</span> <span class="o">=</span> <span class="nx">SceneJS</span><span class="p">.</span><span class="nx">createScene</span><span class="p">({</span>
     <span class="nx">nodes</span><span class="o">:</span> <span class="p">[</span>

         <span class="c1">// Mouse-orbited camera, implemented by plugin at</span>
         <span class="c1">// http://scenejs.org/api/latest/plugins/node/cameras/orbit.js</span>
         <span class="p">{</span>
             <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;cameras/orbit&quot;</span><span class="p">,</span>
             <span class="nx">yaw</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
             <span class="nx">pitch</span><span class="o">:</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span>
             <span class="nx">zoom</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
             <span class="nx">zoomSensitivity</span><span class="o">:</span> <span class="mf">0.1</span><span class="p">,</span>

             <span class="nx">nodes</span><span class="o">:</span> <span class="p">[{</span>
                 <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;material&quot;</span><span class="p">,</span>
                 <span class="nx">color</span><span class="o">:</span> <span class="p">{</span>
                     <span class="nx">r</span><span class="o">:</span> <span class="mf">0.6</span><span class="p">,</span>
                     <span class="nx">g</span><span class="o">:</span> <span class="mf">0.6</span><span class="p">,</span>
                     <span class="nx">b</span><span class="o">:</span> <span class="mf">0.9</span>
                 <span class="p">},</span>
                 <span class="nx">nodes</span><span class="o">:</span> <span class="p">[</span>

                     <span class="c1">// Our depthbuf node, with an ID so we can find it in the scene</span>
                     <span class="p">{</span>
                         <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;depthbuf&quot;</span><span class="p">,</span>
                         <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;myDepthbuf&quot;</span><span class="p">,</span>
                         <span class="nx">enabled</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// Default</span>
                         <span class="nx">clearDepth</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="c1">// Default - clamped to [0..1]</span>

                         <span class="c1">// Default - also &quot;equal&quot;,&quot;lequal&quot;,&quot;greater&quot;,&quot;notequal&quot; and &quot;gequal&quot;</span>
                         <span class="nx">depthFunc</span><span class="o">:</span> <span class="s2">&quot;less&quot;</span><span class="p">,</span>

                         <span class="nx">nodes</span><span class="o">:</span> <span class="p">[</span>

                             <span class="c1">// Teapot primitive, implemented by plugin at</span>
                             <span class="c1">// http://scenejs.org/api/latest/plugins/node/prims/teapot.js</span>
                             <span class="p">{</span>
                                 <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;prims/teapot&quot;</span>
                             <span class="p">}</span>
                         <span class="p">]</span>
                     <span class="p">}</span>
                 <span class="p">]</span>
             <span class="p">}]</span>
         <span class="p">}</span>
     <span class="p">]</span>
 <span class="p">});</span>
</code></pre></div>

<p>And there’s your teapot, with depth buffer working with default values:
<br /><br />
<img src="/images/scenejs/depthbufDefaults.png" alt="depthbuf Defaults" />
<br /><br /></p>

<h3 id="setting-cleardepth">Setting clearDepth</h3>

<p>Now let’s get that <code>depthbuf</code> node and set its <code>clearDepth</code> to a point in normalised View-space that
cuts through the teapot:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">scene</span><span class="p">.</span><span class="nx">getNode</span><span class="p">(</span><span class="s2">&quot;myDepthbuf&quot;</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">myDepthbuf</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">myDepthbuf</span><span class="p">.</span><span class="nx">setClearDepth</span><span class="p">(.</span><span class="mi">989</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>

<p>Now all pixels
<br /><br />
<img src="/images/scenejs/depthbufEnabledWithClearDepth.png" alt="depthbuf Defaults" />
<br /><br /></p>

<h3 id="setting-depthfunc">Setting depthFunc</h3>

<p>The <code>depthFunc</code> attribute decides how each in
Now let’s get that <code>depthbuf</code> node and set its <code>clearDepth</code> to a point in normalised View-space that
cuts through the teapot:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">scene</span><span class="p">.</span><span class="nx">getNode</span><span class="p">(</span><span class="s2">&quot;myDepthbuf&quot;</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">myDepthbuf</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">myDepthbuf</span><span class="p">.</span><span class="nx">setClearDepth</span><span class="p">(.</span><span class="mi">989</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>

<p>Now all pixels
<br /><br />
<img src="/images/scenejs/depthbufEnabledWithClearDepth.png" alt="depthbuf Defaults" />
<br /><br /></p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="/images/largePortrait.jpg" class="bio-photo" alt="@xeoLabs bio photo"></a>
<h3><a href="http://xeolabs.com">@xeoLabs</a></h3>
<p>Lindsay Kay<br>3D Web developer</p>
<a href="http://twitter.com/xeolabs" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>

<a href="https://plus.google.com/u/0/110983138227486752827/posts" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="http://linkedin.com/in/lindsaystanleykay" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>

<a href="http://github.com/xeolabs" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>


        </div>
        <p class="byline"><strong>Using the SceneJS Depth Buffer</strong> was published on <time datetime="2013-10-28T00:00:00-04:00" itemprop="datePublished">October 28, 2013</time> and last modified on <time datetime="2013-05-31" itemprop="dateModified">May 31, 2013</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="/about" title="About @xeoLabs" itemprop="url">@xeoLabs</a></span></span>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/articles">View all articles</a>)</small></h4>
    <ul>
    
      
      
      
      <li><a href="/articles/scenejs-quick-start" title="SceneJS Quick Start">SceneJS Quick Start</a></li>
      
    
      
      
      
      <li><a href="/articles/scenejs-physics" title="SceneJS Physics">SceneJS Physics</a></li>
      
    
      
      
      
      <li><a href="/articles/scenejs-node-types" title="Extending SceneJS">Extending SceneJS</a></li>
      
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2013 @xeoLabs. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


</body>
</html>
