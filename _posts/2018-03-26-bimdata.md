---
layout: post
title: BIMDataâ„¢ Online 3D BIM Viewer
description: Developed the 3D BIM viewer for <b>BIMData.io</b>, a cutting-edge platform to manage your construction projects that provides an all-in-one solution to visualize, check, edit and share building information. 
thumbnail: bimdata/bimdata.png
modified: 2018-19-09
category: portfolio
comments: false
location: "Lyon, France"
article: true
tags: [xeogl, bimdata, BIM, IFC, webgl]
tech: "WebGL, glTF, xeogl"
website: http://www.bimdata.io/en/bim-data-en/
websiteReadible: http://bimdata.io
---
 
In 2018, I worked remotely with **[BIMData](http://www.bimdata.io/en/bim-data-en/)** in Lyon, France, to develop the WebGL-based 3D viewer 
component of their online building information modeling (BIM) platform.
<br><br>
We developed the viewer on **[xeogl](http://xeogl.org)**, an open source WebGL library I created for developing 
3D model visualization applications in Web browsers without using plugins.
<br><br>
In this article, I'll describe how we (TODO)
<br><br>

[![]({{ site.url }}/images/bimdata/bimdata.png)](http://www.bimdata.io/en/bim-data-en/)

# Contents

- [Background](#background)
- [The Client](#the-client)
- [Requirements](#requirements)
- [Solution](#solution)
  * [Architecture](#architecture)
  * [glTF models](#gltf-models)
      - [Geometry compression and batching](#geometry-compression-and-batching)
  * [Annotations](#annotations)
  * [Cross-section views](#cross-section-views)
  * [ViewCube](#viewcube)
  * [Emphasis effects](#emphasis-effects)
  * [Measurement tools](#measurement-tools)
  * [Camera navigation](#camera-navigation)
  * [BCF](#bcf)
  * [Isolated object view](#isolated-object-view)

# Background

**BIM** is a process involving the generation and management of digital representations of physical and functional characteristics 
of buildings, usually while constructing them.
<br><br> 
**WebGL** is (TODO) and allows BIM models to be viewed online. IFC viewers are typically written as desktop apps, which allow 
them efficiently render huge models via OpenGL/DirectX etc. The browser however (TODO) The challenge is how to engineer 
things so that work at scale within the browser. WIP!


# The Client

**[BIMData](http://www.bimdata.io/en/bim-data-en/)** is a company in Lyon, France that provides a cutting-edge online 
BIM platform to manage your construction projects, including an all-in-one solution to visualize, check, edit and share 
building information. 
<br><br>
Our development team included about eighteen developers, mostly in Lyon, but also


# Requirements
 
 - Implement a WebGL-based viewer in JavaScript, to view large 3D IFC models in Web browsers, without plugins
 - Load IFC models from glTF   
 - Emphasise and reveal objects using ghosting, wireframing and highlighting
 - Ability to annotate models with 3D labels
 - Cross section views
 - Isolated object views
 - Measurement tools, to find areas and distances within models
 - A camera navigation gizmo similar to AutoDesk ViewCube
 - Orbit, first-person and walk-through navigation modes
 - Ability to capture and share views via BCF format
 
# Solution

### Using xeogl

I implemented the BIMData viewer as a wrapper around **[xeogl](http://xeogl.org)**, which is an open source (MIT) 
 library I created for WebGL-based visualization.
 <br><br>
 xeogl is also used in other commercial projects and is 
 starting to receive contributions from other developers. This means that improvements and optimizations that we 
 make to xeogl for those projects will also benefit the BIMData platform.
 <br><br>
Being geared to engineering visualization, xeogl supports many of this project's requirements out-of-the-box. For the more 
  application-specific requirements, I extended it with proprietary components, for things like custom camera 
  controls and interaction widgets.
        
### Sub-contracting

For this job, I sub-contracted [David Lenaerts](http://www.derschmale.com/), a freelance graphics programmer, to help out with 
the math for 3D gizmo interactions. This was the first time I ever subcontracted anyone, and I'd recommend David to any developer 
who needs help with their WebGL projects.
 
### Aplication architecture

Our viewer is a facade class that wraps xeogl in a set of application-specific functions, with a plugin architecture 
 into which we can add tools and gizmos.
 <br><br>
 ![]({{ site.url }}/images/bimdata/uml.png)
 
This plugin architecture enabled us to deploy the core functionality of the viewer as soon as it was ready, then deploy 
 various tools and gizmos incrementally, as we developed them.

### glTF geometry pipeline

We're using [glTF](https://www.khronos.org/gltf/) as the file format for our IFC models.  Within the viewer, we're 
loading glTF into the 3D scene using xeogl's [GLTFModel](http://xeogl.org/docs/classes/GLTFModel.html) components. 

#### Geometry compression and batching

glTF gives us options for geometry compression, such as Draco and attribute quantization. Quantization 
is where we compress floating-point geometry arrays into integers, then decompress them on the GPU, within the WebGL shader. 
This gives us smaller glTF files, plus a smaller memory footprint within the viewer. If the glTF geometry is not 
compressed, then xeogl's GLTFModel automatically quantizes it, while also batching it into the same 
vertex buffer objects (VBOs) to optimize WebGL rendering. This enables us to render models with 200k+ objects.
<br><br> 
As soon as WebGL 2 becomes available in enough browsers, xeogl will begin using hardware instancing, which will give 
us the ability to render even larger models.    

### User annotations

Annotations are notes that users pin to the surface of models. Our annotations are based on xeogl's experimental 
[Annotation](http://xeogl.org/docs/classes/Annotation.html) components. 
<br><br>
These are able to automatically hide themselves whenever something else occludes them in the 3D view. 
<br><br>
![]({{ site.url }}/images/bimdata/annotations.gif)

### Cross-section views

Our users can create an unlimited number of cross-section planes, which they can arrange using mouse and touch input.
<br><br>
Under the hood, our cross-section planes use xeogl's core [Clip](http://xeogl.org/docs/classes/Clip.html) components, 
which users can interactively arrange using our fancy repositioning gizmo. That was one of the bits 
that [David Lenaerts](http://www.derschmale.com/) helped out with.
<br><br>
![]({{ site.url }}/images/bimdata/clipping.gif)

### ViewCube camera controller

Our ViewCube is a 3D camera orientation indicator and controller, which works the same as the 
one by Autodesk Research. Ours is a 3D gizmo I implemented on xeogl, with clickable hotspots that fly the camera 
to various vantage points. 
<br><br>
![]({{ site.url }}/images/bimdata/viewCube.gif)
 
### Isolated object view

### Emphasis effects

xeogl has some built-in emphasis effects, such as ghosting and wireframe, which we're using for highlighting and 
revealing BIM objects. 
<br><br>
![]({{ site.url }}/images/bimdata/highlight.gif)
<br><br>
Edge emphasis and ghosting effects for X-ray view:
<br><br>
![]({{ site.url }}/images/bimdata/ghosting.gif)

### Measurement tools

#### Simple distance

- uses xeogl 3D surface picking (describe)
- xeogl.Pins
- custom widget with interactive HTML elements etc

![]({{ site.url }}/images/bimdata/measureDistance.gif)

### Camera navigation

TODO

### BCF 

The BIM Collaboration Format (BCF) is an open file format that supports workflow communication in BIM processes.
<br><br>
Our BCF system captures the complete visual state of the viewer as a JSON BCF record, that contains all the 
relevant viewer state, such as object visibilities and emphasis appearance, camera position, cross-section planes, 
annotations, as well as PNG snapshot image of the canvas.
<br><br>
Users can capture a BCF record of the viewer state, to indicate an issue within a model, then share that with other users, 
 who can then load that view to see what the problem is.

# Conclusion

<!-- TODO -->

<!-- <section id="table-of-contents" class="toc"> -->
  <!-- <header> -->
    <!-- <h3>Contents</h3> -->
  <!-- </header> -->
<!-- <div id="drawer" markdown="1"> -->
<!-- *  Auto generated table of contents -->
<!-- {:toc} -->
<!-- </div> -->
<!-- </section><!--/#table-of-contents--> -->

